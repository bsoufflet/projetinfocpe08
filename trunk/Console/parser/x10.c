#include "x10.h"void int2hex(char* resultat,int valeur){	printf ("int2hex valeur recue %d\n", valeur);	sprintf (resultat, "%x", valeur);}//*****************************************************************int set_clock (int fd){	unsigned char com_clock[7];	com_clock[0] = 0x9B;	com_clock[1] = 0x28;	com_clock[2] = 0x41;	com_clock[3] = 0x04;	com_clock[4] = 0x10;	com_clock[5] = 0x20;	com_clock[6] = 0x67;		write (fd, com_clock, 7);		checksum = ((com_clock[0] + com_clock[1]+com_clock[2]+com_clock[3]+com_clock[4]+com_clock[5]+com_clock[6]) & 0xFF);	usleep(100000);	read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("set_clock: erreur read de checsum adresse\n");		return 1;	}	com_serie[0] = transmit_ok;	//0X00	write (fd, com_serie, 1);			checksum = interface_ready;	//0x55		usleep(1000000);		com_serie[0] = 0xFF;		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("set_clock: erreur de read de checksum 0x55 %x\n",com_serie[0]);		//close (fd);		return 1;	}	return 0;}//*****************************************************************int adresse_transmit (int fd, unsigned char adresse){	printf ("dans adresse transmit\n");	com_serie[0] = header_adresse;	com_serie[1] = adresse;	printf ("adresse %x\n", adresse);	write (fd, com_serie, 2);		checksum = ((com_serie[0]+com_serie[1])& 0xff);		usleep(100000);	// liaison serie lente il faut attendre la réponse sans charger le liaison serie		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur read de checsum adresse\n");		return 1;	}			com_serie[0] = transmit_ok;	write (fd, com_serie, 1);			checksum = interface_ready;		usleep(1000000);		com_serie[0] = 0xFF;		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur de read de checksum 0x55 %x\n",com_serie[0]);		//close (fd);		return 1;	}	return 0;}//*****************************************************************int prise_on (int fd, int house_code){	int fonction;	printf ("dans on\n");	com_serie[0] = header_fonction;	fonction = 16*house_code+2;	memcpy(&com_serie[1], &fonction, 1);		write (fd, com_serie, 2);		checksum = ((com_serie[0]+com_serie[1])& 0xff);		usleep(100000);		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur read checksum fonction on\n");		return 1;	}		com_serie[0] = transmit_ok;	write (fd, com_serie, 1);			checksum = interface_ready;		usleep(1000000);		com_serie[0] = 0xFF;		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur read checksum 0x55 on %x\n",com_serie[0]);		//close (fd);		return 1;	}	return 0;}//*****************************************************************int prise_off (int fd, int house_code){	int fonction;	printf ("dans off\n");	com_serie[0] = header_fonction;	fonction = 16*house_code+3;	memcpy(&com_serie[1], &fonction, 1);		write (fd, com_serie, 2);		checksum = ((com_serie[0]+com_serie[1])& 0xff);		usleep(100000);		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur read checksum fonction off\n");		return 1;	}		com_serie[0] = transmit_ok;	write (fd, com_serie, 1);			checksum = interface_ready;		usleep(1000000);		com_serie[0] = 0xFF;		read (fd, com_serie, 1);		if(com_serie[0] != checksum) 	{		printf("erreur read checksum 0x55 off %x\n",com_serie[0]);		//close (fd);		return 1;	}	return 0;}